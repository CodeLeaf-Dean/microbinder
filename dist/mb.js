class ObjectHandler{constructor(t){this.mb=t,this.t=this,this.i={},this.h={},this.parentProxy=null}u(t,r,i,s){if("constructor"==t)return null;null==this.h[t]&&(this.h[t]=[]);var e=this.h[t];if(!Array.isArray(e))return null;var n={l:r,o:()=>this.h[t],v:i,p:s};return e.push(n),n}A(t,r,i){if(null!=this.h[t])for(var s=this.h[t].length-1;s>=0;s--)this.h[t][s].l(i,r)}get(t,r,i){if("_proxyHandler"===r)return this;if("_parentProxy"===r)return this.parentProxy;if("_isProxy"===r)return!0;if("_proxyObject"===r)return t;if("_subscribe"===r)return this.u.bind(this);var s=Reflect.get(t,r,i);if(this.mb._&&(this.mb.g.find((t=>t.handler==this&&t.prop==r))||this.mb.g.push({handler:this,prop:r})),//!(this instanceof DateHandler) && 
this.mb.j&&this.mb.H.push((t=>i[r]=t)),null!=s&&"object"==typeof s){if(null==this.i[r]){var e=this.mb.wrap(s);e.O.parentProxy=i,e.O.parentProp=r,this.i[r]=e}return this.i[r]}return s}set(t,r,i,s){var e=!1;null!=i&&i.D&&(this.i[r]=i,i=i.m,e=!0);var n=t[r],h=Reflect.set(t,r,i,s);if("object"==typeof i&&!e){var a=this.i[r];if(delete this.i[r],Array.isArray(i)){var u=s[r];a&&(a.length=0,u.O.B=a.O.B),u.O.I(0,0,i.length,u)}}return this.A(r,n,i),h}}class DateHandler extends ObjectHandler{constructor(t){super(t)}get(t,r,i){var s=super.get(t,r,i);return"function"==typeof s?function(r){var i=new Date(t.valueOf()),e=s.apply(t,arguments);return t!=i&&this.parentProxy.O.A(this.parentProp,i,t),e}.bind(this):s}set(t,r,i,s){return super.set(t,r,i,s)}}class ArrayHandler extends ObjectHandler{constructor(t,r,i){super(t),this.i=[],this.P=[],this.B=[]}I(t,r,i,s){var e=[];e[0]=t,e[1]=r;for(let t=0;t<i;t++)e[t+2]=null;if(Array.prototype.splice.apply(this.i,e),this.B.length>0){let e=this.B[0];e.$array.childContexts.splice(t,r);for(let r=t;r<t+i;r++){const t=s[r];e.$array.childContexts.splice(r,0,new BindingContext(this.mb,t,r,e.$context))}for(let r=t+i;r<e.$array.childContexts.length;r++)e.$array.childContexts[r].$index=r}this.B.forEach((s=>{for(let i=0;i<r;i++)s.bindArray[t+i].forEach((t=>t.remove()));var e=[];e[0]=t,e[1]=r;for(let t=0;t<i;t++)e[t+2]=[];Array.prototype.splice.apply(s.bindArray,e)})),this.B.forEach((r=>{var e=document.createDocumentFragment(),n=r.insertFunc;for(let h=t;h<t+i;h++){const t=s[h];n.call(t,r.$array.childContexts[h],e,r)}var h=r.bindArray;if(null==t||t>=h.length)r.appendChild(e);else if(0==t)r.prepend(e);else{var a=(h=r.bindArray[t-1])[h.length-1].nextSibling;r.insertBefore(e,a)}})),this.parentProxy.O.A(this.parentProp,this.parentProxy)}get(t,r,i){var s=super.get(t,r,i);return"childContexts"===r?this.P:"function"==typeof s?"splice"===r?function(r){var s=arguments[0];s>t.length&&(s=t.length),s<-t.length&&(s=0),s<0&&(s=t.length+s+1);var e=1==arguments.length?t.length-s:arguments[1];e>t.length-s&&(e=t.length-s);var n=Array.prototype.splice.apply(t,arguments);return this.I(s,e,arguments.length-2,i),n}.bind(this):"push"===r?function(r){var s=t.length,e=Array.prototype.push.apply(t,arguments);return this.I(s,0,arguments.length,i),e}.bind(this):"pop"===r?function(){if(0!=t.length){var r=t.length,s=Array.prototype.pop.apply(t,arguments);return this.I(r-1,1,0,i),s}}.bind(this):"shift"===r?function(){if(0!=t.length){var r=Array.prototype.shift.apply(t,arguments);return this.I(0,1,0,i),r}}.bind(this):"unshift"===r?function(r){var s=Array.prototype.unshift.apply(t,arguments);return this.I(0,0,1,i),s}.bind(this):"reverse"===r||"sort"==r?function(s){var e=Array.prototype[r].apply(t,arguments);return this.I(0,t.length,t.length,i),e}.bind(this):"fill"===r?function(r){var s=arguments[1]||0,e=arguments[2]||t.length;s<0&&(s=ob.length+s),e<0&&(e=ob.length+e);var n=Array.prototype.fill.apply(t,arguments);return this.I(s,e,e-s,i),n}.bind(this):s.bind(i):s}set(t,r,i,s){var e=t.length,n=Reflect.set(t,r,i,s);return"length"===r?e>i&&this.I(i,e-i):t.length===e?this.I(parseInt(r),1,1,t):this.I(parseInt(r),0,1,t),n}}class MicroBinder{constructor(){this.R=1,this.C={},this._=!1,this.g=[],this.bindObjects=[],this.bindObjectCount=-1}wrap(t){if(t.D)return t;var r="[object Date]"===Object.prototype.toString.call(t)?new DateHandler(this):Array.isArray(t)?new ArrayHandler(this,null,t):new ObjectHandler(this);return new Proxy(t,r)}unwrap(t){return t.D?t.m:t}bind(t,r,i){this._=!0,this.g=[];var s=t.call();if(this._=!1,this.g.length>0){var e=this.R++;this.C[e]=[],this.g.forEach((i=>{var s=i.handler.u(i.prop,((i,s)=>{this.C[e].forEach((t=>t.o().splice(t.o().indexOf(t),1))),delete this.C[e],this.bind(t,r,s)}),t,e);s&&this.C[e].push(s)}))}r(s,i)}}var mb_debug=new MicroBinder;export default mb_debug;