class MicroBinder{constructor(){this.t=1,this.i={},this.s=!1,this.h=[],this.bindObjects=[],this.subBinders={if:1,with:1,foreach:1},this.binders={text:(t,e,n)=>mb.bind(e,n,e=>t.innerText=e),html:(t,e,n)=>mb.bind(e,n,e=>t.innerHTML=e),value:(t,e,n)=>{mb.bind(e,n,e=>t.value=e||""),t.addEventListener("change",t=>mb.setValue(e,n,t.target.value))},textInput:(t,e,n)=>{mb.bind(e,n,e=>t.value=e||""),t.addEventListener("input",t=>mb.setValue(e,n,t.target.value))},checked:(t,e,n)=>{mb.bind(e,n,e=>{e?t.setAttribute("checked",""):t.removeAttribute("checked","")}),t.addEventListener("change",t=>mb.setValue(e,n,t.target.checked))},hasFocus:(t,e,n)=>{mb.bind(e,n,e=>e?t.focus():t.blur()),t.addEventListener("focus",t=>mb.setValue(e,n,!0)),t.addEventListener("blur",t=>mb.setValue(e,n,!1))},css:(t,e,n)=>{for(const r in n)mb.bind(e,n[r],e=>e?t.classList.add(r):t.classList.remove(r))},attr:(t,e,n)=>{for(const r in n)mb.bind(e,n[r],e=>t.setAttribute(r,e))},style:(t,e,n)=>{for(const r in n)mb.bind(e,n[r],e=>t.style[r]=e)},visible:(t,e,n)=>mb.bind(e,n,e=>t.style.display=e?null:"none"),click:(t,e,n)=>t.addEventListener("click",r=>n.call(e,t)),submit:(t,e,n)=>t.addEventListener("submit",r=>n.call(e,t)),if:(t,e,n,r)=>{t.insertFunc=this.bindObjects[r-1],mb.bind(e,n,n=>{if(n){var r=document.createDocumentFragment();t.insertFunc.call(e,e,()=>0,r,t),t.appendChild(r)}else t.innerHTML=""})},with:(t,e,n,r)=>{t.insertFunc=this.bindObjects[r-1],mb.bind(e,n,e=>{t.innerHTML="";var n=document.createDocumentFragment();t.insertFunc.call(e,e,()=>0,n,t),t.appendChild(n)})},foreach:(t,e,n,r)=>{t.insertFunc=this.bindObjects[r-1];var i=n.call(e);t.bindArray=[],i.proxyHandler.l.push(t);var s=document.createDocumentFragment();for(let e=0;e<i.length;e++){const n=i[e];t.insertFunc.call(n,n,e,s,t,i.proxyHandler)}t.appendChild(s)},selectedOptions:(t,e,n)=>{mb.bind(e,n,e=>{var n=e.map(t=>t.toString());Array.from(t.options).forEach(t=>t.selected=n.indexOf(t.value)>-1)}),t.addEventListener("change",t=>{var r=Array.from(t.target.selectedOptions).map(t=>t.value);mb.setValue(e,n,r)})},event:(t,e,n)=>{for(const r in n){const i=n[r];t.addEventListener(r,n=>i.call(e,t))}},enable:(t,e,n)=>{mb.bind(e,n,e=>e?t.removeAttribute("disabled"):t.setAttribute("disabled",""))},disable:(t,e,n)=>{mb.bind(e,n,e=>e?t.setAttribute("disabled",""):t.removeAttribute("disabled"))}}}bind(t,e,n){this.s=!0,this.h=[];var r=e.call(t);if(this.s=!1,this.h.length>0){var i=this.t++;this.i[i]=[],this.h.forEach(t=>t.handler.u(t.prop,e,n,i))}n(r)}setValue(t,e,n){this.o=!0,this.m=[];e.call(t);this.o=!1,this.m.length>0&&this.m.pop()(n)}executeBinding(t,e,n,r){var i=!1;for(var s in n)i=mb.binders[s](t,e,n[s],r)|i;return i}indexFunc(t,e){for(var n=t;null==n.bindIndex;)n=n.parentNode;return mb.s&&mb.h.push({handler:e,prop:"$index"}),n.bindIndex}v(t){var e=[];return e.maxDepth=0,e.push("var $parent = $data.$parent, t = null, $index = null;\n"),e.push("var renderedElements = [];\n"),"[object NodeList]"===t.toString()?t.forEach(t=>this.p(t,e,1)):this.p(t,e,0),e.push("if(!$element.bindArray)$element.bindArray=[];\n"),e.push("$element.bindArray[index] = renderedElements;\n"),new Function("$data,index,n0,$element,handler",e.join(""))}p(t,e,n){var r=!1;1==t.nodeType?(e.push(n>e.maxDepth?"var ":"","n",n," = document.createElement('",t.nodeName,"');\n"),1==n&&(e.push("n",n,".bindIndex = index;"),e.push("$index = mb.indexFunc.bind(null, n",n,",handler);")),n>e.maxDepth&&(e.maxDepth=n),t.getAttributeNames().forEach(i=>{if("bind"==i){var s=new Function("return "+t.getAttribute(i))();(r=Object.keys(s).some(t=>Object.keys(this.subBinders).indexOf(t)>=0))&&this.bindObjects.push(this.v(t.childNodes)),e.push("mb.executeBinding(n",n,", $data, ",t.getAttribute(i),", ",this.bindObjects.length,");\n")}else e.push("n",n,".setAttribute('",i,"', '",t.getAttribute(i),"');\n")}),e.push("n",n-1,".appendChild(n",n,");\n\n"),n-1==0&&e.push("renderedElements.push(n",n,");\n\n")):3==t.nodeType&&(e.push("t = document.createTextNode(`",t.nodeValue,"`);\n"),e.push("n",n-1,".appendChild(t);\n\n"),n-1==0&&e.push("renderedElements.push(t);\n\n")),r||t.childNodes.forEach(t=>this.p(t,e,n+1))}render(t,e,n){var r="object"!=typeof t||t.isProxy?t:new Proxy(t,new ObjectHandler),i=null;if("string"==typeof n){var s=document.getElementById(n);if(null!=s)i=s.content?s.content.cloneNode(!0):document.createRange().createContextualFragment(s.innerHTML);else{var a=document.createDocumentFragment();a.innerHTML=n,i=a.content}}else i=n;return null==i&&(i=e||document.body),this.v(i,r).call(r,r,()=>0,e,e),r}}var mb=new MicroBinder;class ObjectHandler{constructor(){this.A=this,this.j={},this.$={},this.$parent=null}u(t,e,n,r){null==this.$[t]&&(this.$[t]=[]);var i=this.$[t],s={g:i,H:e,O:n,F:r};i.push(s),mb.i[r].push(s)}_(t,e){if(null!=this.$[t]){var n=[];this.$[t].forEach(t=>{mb.bind(e,t.H,t.O),n.push(t.F)}),n.forEach(t=>{mb.i[t].forEach(t=>t.g.splice(t.g.indexOf(t),1)),delete mb.i[t]})}}get(t,e,n){if("proxyHandler"===e)return this;if("$parent"===e)return this.$parent;if("isProxy"===e)return!0;if("proxyObject"===e)return t;var r=Reflect.get(t,e,n);if(mb.s&&mb.h.push({handler:this,prop:e}),this instanceof DateHandler||!mb.o||mb.m.push(t=>n[e]=t),null!=r&&"object"==typeof r){if(null==this.j[e]){var i="[object Date]"===Object.prototype.toString.call(r)?new DateHandler:Array.isArray(r)?new ArrayHandler(e,n):new ObjectHandler;i.$parent=n,this.j[e]=new Proxy(r,i)}return this.j[e]}return r}set(t,e,n,r){null!=n&&n.isProxy&&(n=n.proxyObject);var i=Reflect.set(t,e,n,r);if("object"==typeof n){var s=this.j[e];if(delete this.j[e],Array.isArray(n)){var a=r[e];s&&(s.length=0,a.proxyHandler.l=s.proxyHandler.l),a.proxyHandler.I(0,0,n.length,a)}}return this._(e,r),i}}class DateHandler extends ObjectHandler{constructor(){super()}get(t,e,n){var r=super.get(t,e,n);return"function"==typeof r?function(i){var s=t,a=r.apply(t,arguments);return t!=s&&this._(e,n),a}.bind(this):r}}class ArrayHandler extends ObjectHandler{constructor(t,e){super(),this.j=[],this.l=[],this.k=t,this.B=e}I(t,e,n,r){var i=[];i[0]=t,i[1]=e;for(let t=0;t<n;t++)i[t+2]=null;Array.prototype.splice.apply(this.j,i),this.l.forEach(r=>{for(let n=0;n<e;n++)r.bindArray[t+n].forEach(t=>t.remove());var i=[];i[0]=t,i[1]=e;for(let t=0;t<n;t++)i[t+2]=[];Array.prototype.splice.apply(r.bindArray,i)}),this.l.forEach(e=>{var i=document.createDocumentFragment(),s=e.insertFunc;for(let a=t;a<t+n;a++){const t=r[a];s.call(t,t,a,i,e,this)}var a=e.bindArray;if(null==t||t>=a.length)e.appendChild(i);else if(0==t)e.prepend(i);else{var h=(a=e.bindArray[t-1])[a.length-1].nextSibling;e.insertBefore(i,h)}}),this.l.forEach(e=>{for(let r=t+n;r<e.bindArray.length;r++)e.bindArray[r].forEach(t=>t.bindIndex=r)}),this._("$index",r),this.B.proxyHandler._(this.k,this.B)}get(t,e,n){var r=super.get(t,e,n);return"function"==typeof r?"splice"===e?function(e){var r=arguments[0];r>this.length&&(r=this.length),r<-this.length&&(r=0),r<0&&(r=this.length+r+1);var i=1==arguments.length?this.length-r:arguments[1];i>this.length-r&&(i=this.length-r);var s=Array.prototype.splice.apply(t,arguments);return this.I(r,i,arguments.length-2,n),s}.bind(this):"push"===e?function(e){var r=t.length,i=Array.prototype.push.apply(t,arguments);return this.I(r,0,arguments.length,n),i}.bind(this):"pop"===e?function(){if(0!=t.length){var e=t.length,r=Array.prototype.pop.apply(t,arguments);return this.I(e-1,1,0,n),r}}.bind(this):"shift"===e?function(){if(0!=t.length){var e=Array.prototype.shift.apply(t,arguments);return this.I(0,1,0,n),e}}.bind(this):"unshift"===e?function(e){var r=Array.prototype.unshift.apply(t,arguments);return this.I(0,0,1,n),r}.bind(this):"reverse"===e||"sort"==e?function(r){var i=Array.prototype[e].apply(t,arguments);return this.I(0,t.length,t.length,n),i}.bind(this):"fill"===e?function(e){var r=arguments[1]||0,i=arguments[2]||t.length;r<0&&(r=ob.length+r),i<0&&(i=ob.length+i);var s=Array.prototype.fill.apply(t,arguments);return this.I(r,i,i-r,n),s}.bind(this):r.bind(n):r}set(t,e,n,r){var i=t.length,s=Reflect.set(t,e,n,r);return"length"===e?i>n&&this.I(n,i-n):t.length===i?this.I(parseInt(e),1,1,t):this.I(parseInt(e),0,1,t),s}}