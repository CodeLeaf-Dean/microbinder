class MicroBinder{constructor(){this.t=1,this.i={},this.s=!1,this.o=[],this.bindObjects=[],this.bindObjectCount=-1,this.defaultBinders=[{match:"input[type=text]",binder:"textInput"},{match:"ul",binder:"foreach"},{match:"button",binder:"click"}],this.subBinders={if:1,with:1,foreach:1},this.binders={text:(t,e,n)=>mb.bind(e,n,(e,n)=>t.innerText=n),html:(t,e,n)=>mb.bind(e,n,(e,n)=>t.innerHTML=n),value:(t,e,n)=>{mb.bind(e,n,(e,n)=>t.value=n||""),t.addEventListener("change",t=>mb.setValue(e,n,t.target.value))},textInput:(t,e,n)=>{mb.bind(e,n,(e,n)=>t.value=n||""),t.addEventListener("input",t=>mb.setValue(e,n,t.target.value))},checked:(t,e,n)=>{mb.bind(e,n,(e,n)=>{n?t.setAttribute("checked",""):t.removeAttribute("checked","")}),t.addEventListener("change",t=>mb.setValue(e,n,t.target.checked))},hasFocus:(t,e,n)=>{mb.bind(e,n,(e,n)=>n?t.focus():t.blur()),t.addEventListener("focus",t=>mb.setValue(e,n,!0)),t.addEventListener("blur",t=>mb.setValue(e,n,!1))},css:(t,e,n)=>{for(const r in n)mb.bind(e,n[r],(e,n)=>n?t.classList.add(r):t.classList.remove(r))},attr:(t,e,n)=>{for(const r in n)mb.bind(e,n[r],(e,n)=>t.setAttribute(r,n))},prop:(t,e,n)=>{for(const r in n)mb.bind(e,n[r],(e,n)=>t[r]=n);t.addEventListener("propchange",t=>{null!=n[t.name]&&mb.setValue(e,n[t.name],t.newValue)})},props:(t,e,n)=>{mb.bind(e,n,(e,n)=>{for(const e in n)mb.bind(n,()=>n[e],(n,r)=>t[e]=r)}),t.addEventListener("propchange",t=>{var e=n();null!=e[t.name]&&mb.setValue(e,()=>e[t.name],t.newValue)})},style:(t,e,n)=>{for(const r in n)mb.bind(e,n[r],(e,n)=>t.style[r]=n)},visible:(t,e,n)=>mb.bind(e,n,(e,n)=>t.style.display=n?null:"none"),click:(t,e,n)=>t.addEventListener("click",t=>n()(e.$data,t)),enter:(t,e,n)=>{t.addEventListener("keypress",t=>{13===t.keyCode&&n()(e.$data,t)})},submit:(t,e,n)=>t.addEventListener("submit",t=>n()(e.$data,t)),if:(t,e,n,r)=>{t.insertFunc=this.bindObjects[r],t.$context=e,t.h=!1,mb.bind(e,n,(n,r)=>{if(r&&!t.h){var i=document.createDocumentFragment();t.insertFunc.call(e.$data,e,i,t),t.appendChild(i),t.h=!0}else!r&&t.h&&(t.innerHTML="",t.h=!1)})},with:(t,e,n,r)=>{t.insertFunc=this.bindObjects[r],t.$context=c,mb.bind(e,n,(e,n)=>{t.innerHTML="";var r=document.createDocumentFragment();t.insertFunc.call(c.$data,c,r,t),t.appendChild(r)})},foreach:(t,e,n,r)=>{t.insertFunc=this.bindObjects[r],t.$context=e;var i=n.call(e.$data);t.bindArray=[],i.proxyHandler.u.push(t);var s=document.createDocumentFragment();for(let n=0;n<i.length;n++){const r=i[n];null==e.childContexts[n]&&(e.childContexts[n]=new BindingContext(r,n,e)),t.insertFunc.call(r,e.childContexts[n],s,t)}t.appendChild(s)},selectedOptions:(t,e,n)=>{mb.bind(e,n,(e,n)=>{var r=n.map(t=>t.toString());Array.from(t.options).forEach(t=>t.selected=r.indexOf(t.value)>-1)}),t.addEventListener("change",t=>{var r=Array.from(t.target.selectedOptions).map(t=>t.value);mb.setValue(e,n,r)})},event:(t,e,n)=>{for(const r in n){const i=n[r];t.addEventListener(r,n=>i.call(e,t))}},enable:(t,e,n)=>{mb.bind(e,n,(e,n)=>n?t.removeAttribute("disabled"):t.setAttribute("disabled",""))},disable:(t,e,n)=>{mb.bind(e,n,(e,n)=>n?t.setAttribute("disabled",""):t.removeAttribute("disabled"))}}}bind(t,e,n,r){this.s=!0,this.o=[];var i=e.call(t.$data);if(this.s=!1,this.o.length>0){var s=this.t++;this.i[s]=[],this.o.forEach(t=>t.handler.l(t.prop,e,n,s))}n(r,i)}setValue(t,e,n){this.m=!0,this.v=[];e.call(t.$data);this.m=!1,this.v.length>0&&this.v.pop()(n)}executeBinding(t,e,n,r){var i=!1;for(var s in n)i=mb.binders[s](t,e,n[s],r)|i;return i}p(t){for(let e=0;e<this.defaultBinders.length;e++){const n=this.defaultBinders[e];if(t.matches(n.match))return n.binder}return"text"}g(t,e,n,r,i,s,o){return t.maxDepth=0,t.push("\nvar t = null, $index = null, $parent = null,$data = null;\n"),t.push("var renderedElements = [];\n"),"[object NodeList]"===n.toString()?n.forEach(n=>this.$(n,t,e,1,r,i,s,o)):this.$(n,t,e,0,r,i,s,o),t.push("if($funcElement){\n"),t.push("    if(!$funcElement.bindArray)$funcElement.bindArray=[];\n"),t.push("    $funcElement.bindArray[$context.$index] = renderedElements;\n"),t.push("}\n"),t}A(t,e,n,r,i,s){var o=[];return this.g(o,t,e,n,r,i,s),new Function("$context,n0,$funcElement",o.join(""))}$(t,e,n,r,i,s,o,a){var h=!1;if(1==t.nodeType){if(e.push(r>e.maxDepth?"var ":"","n",r," = document.createElement('",t.nodeName,"');\n"),r>e.maxDepth&&(e.maxDepth=r),e.push("$context.$element = n",r,";\n"),t.hasAttributes()){var c=t.attributes;for(let v=c.length-1;v>=0;v--){const p=c[v].name;var u=c[v].value;if("bind"==p){if(-1==u.indexOf(":"))u="{"+this.p(t)+":"+u+"}";u.startsWith("{")||(u="{"+u+"}");var l={$data:new Proxy((function(){}),new FunctionTester),$index:()=>0},d=new Function("$context","with($context){with($data){ return "+u+"}}")(l);for(const t in d)u=u.replace(new RegExp(t+"s*:"),t+": ()=> ");h=Object.keys(d).some(t=>Object.keys(this.subBinders).indexOf(t)>=0);var b=i;h&&(this.bindObjectCount++,b=this.bindObjectCount,n[this.bindObjectCount]={code:["\n    mb.bindObjects[",this.bindObjectCount,"] = ",this.A(n,t.childNodes,this.bindObjectCount,s,o,!0),";\n"]}),e.push("{");var f=0,m=0;if(s)m=s.substr(0,s.indexOf(t.outerHTML)).match(/\n/g).length,f=e.join("").match(/\n/g).length+3,a?(null==o.offset[i]&&(o.offset[i]=[]),o.offset[i][f]=m):o.root[f]=m;e.push("mb.executeBinding(n",r,", $context, (function(){with($context){with($data){\nreturn ",u,"// line: ",f,", offset: ",a,", src: ",m,"\n}}}).call($context.$data), ",b,");\n"),e.push("}")}else e.push("n",r,".setAttribute('",p,"', '",u,"');\n")}}e.push("n",r-1,".appendChild(n",r,");\n\n"),r-1==0&&e.push("renderedElements.push(n",r,");\n\n")}else 3==t.nodeType&&(e.push("t = document.createTextNode(`",t.nodeValue.replace(/\\/g,"\\\\"),"`);\n"),e.push("n",r-1,".appendChild(t);\n\n"),r-1==0&&e.push("renderedElements.push(t);\n\n"));h||t.childNodes.forEach(t=>this.$(t,e,n,r+1,i,s,o,a))}H(t,e){var n,r={root:[],offset:[]};if("[object NodeList]"===t.toString())n=Array.prototype.reduce.call(t,(function(t,e){return t+(e.outerHTML||e.nodeValue)}),"");else{var i=document.createElement("div");i.appendChild(t.cloneNode(!0)),n=i.innerHTML}var s=["function mb_start(){\n"],o=[];this.g(s,o,t,0,n,r),s.push("};");var a=s.join("").match(/\n/g).length+3;r.root.length=a;for(let t=0;t<o.length;t++){const e=o[t];s.push("// Offset: ",a),r.offset[t].length=e.code.join("").match(/\n/g).length,a+=r.offset[t].length,s=s.concat(e.code)}s.push("\nmb_start();"),s.push("\n"),s.push("//# sourceMappingURL=data:text/plain;base64,");const h=15,c=31,u=32;function l(t){return t.map(d).map(b).join("")}function d(t){if(0===t)return[0];let e=Math.abs(t);const n=[];for(;e>0;){let r=0;0===n.length?(r=t<0?1:0,r|=(e&h)<<1,e>>>=4):(r=e&c,e>>>=5),e>0&&(r|=u),n.push(r)}return n}function b(t){return t.map(t=>"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t]).join("")}var f="",m=0;for(let t=0;t<r.root.length;t++){const e=r.root[t];if(null!=e)f+=l([0,0,v=e-m,0]),m+=v;f+=";"}for(let t=0;t<r.offset.length;t++){const e=r.offset[t];for(let t=0;t<e.length;t++){const n=e[t];var v;if(null!=n)f+=l([0,0,v=n-m,0]),m+=v;f+=";"}}var p={version:3,sources:[e+".template"],names:[],mappings:f,sourcesContent:[n]};return s.push(btoa(JSON.stringify(p))),s.push("\n"),s.push("//# sourceURL="+e+".template.js"),new Function("$context,n0,$funcElement",s.join(""))}j(t,e){var n=null,r="microbinder-root-template";if("string"==typeof e){var i=document.getElementById(e);if(null!=i){if("LINK"==i.nodeName){r=i.href;var s=new XMLHttpRequest;return s.open("GET",i.href),s.onreadystatechange=function(){s.readyState===XMLHttpRequest.DONE&&200===s.status&&mb.render(model.proxyObject,t,s.responseText)},void s.send()}r=e,n=i.content?i.content.cloneNode(!0):document.createRange().createContextualFragment(i.innerHTML)}else{var o=document.createElement("template");o.innerHTML=e,n=o.content}}else n=e;return null==n&&(n=t||document.body.childNodes),null==t&&(t=document.body),this.H(n,r)}makeProxy(t){return"object"!=typeof t||t.isProxy?t:new Proxy(t,new ObjectHandler)}build(t,e){return this.j(t,e)}run(t,e,n){var r=this.makeProxy(t),i=new BindingContext(r);return n.call(r,i,e),r}render(t,e,n){var r=this.build(e,n);return this.run(t,e,r)}}var mb=new MicroBinder;class FunctionTester{has(t,e){return!0}get(t,e,n){return e==Symbol.unscopables?{}:e==Symbol.toPrimitive||"toString"==e?()=>"":n}set(t,e,n,r){}apply(t,e,n){return this}}class ObjectHandler{constructor(){this.O=this,this.C={},this._={},this.parentProxy=null}l(t,e,n,r){null==this._[t]&&(this._[t]=[]);var i={F:()=>this._[t],k:e,B:n,M:r};this._[t].push(i),mb.i[r].push(i)}I(t,e,n,r){if(null!=this._[t]){var i=[];this._[t].forEach(t=>{mb.bind(e,t.k,t.B,n),i.push(t.M)}),i.forEach(t=>{mb.i[t].forEach(t=>t.F().splice(t.F().indexOf(t),1)),delete mb.i[t]})}}get(t,e,n){if("proxyHandler"===e)return this;if("parentProxy"===e)return this.parentProxy;if("isProxy"===e)return!0;if("proxyObject"===e)return t;var r=Reflect.get(t,e,n);if(mb.s&&(mb.o.find(t=>t.handler==this&&t.prop==e)||mb.o.push({handler:this,prop:e})),this instanceof DateHandler||!mb.m||mb.v.push(t=>n[e]=t),null!=r&&"object"==typeof r){if(null==this.C[e]){var i="[object Date]"===Object.prototype.toString.call(r)?new DateHandler:Array.isArray(r)?new ArrayHandler(e,n):new ObjectHandler;i.parentProxy=n,this.C[e]=new Proxy(r,i)}return this.C[e]}return r}set(t,e,n,r){null!=n&&n.isProxy&&(n=n.proxyObject);var i=t[e],s=Reflect.set(t,e,n,r);if("object"==typeof n){var o=this.C[e];if(delete this.C[e],Array.isArray(n)){var a=r[e];o&&(o.length=0,a.proxyHandler.u=o.proxyHandler.u),a.proxyHandler.L(0,0,n.length,a)}}return this.I(e,r,i,n),s}}class DateHandler extends ObjectHandler{constructor(){super()}get(t,e,n){var r=super.get(t,e,n);return"function"==typeof r?function(i){var s=t,o=r.apply(t,arguments);return t!=s&&this.I(e,n,s,o),o}.bind(this):r}set(t,e,n,r){return super.set(t,e,n,r)}}class ArrayHandler extends ObjectHandler{constructor(t,e){super(),this.C=[],this.u=[],this.R=t,this.P=e}L(t,e,n,r){var i=[];i[0]=t,i[1]=e;for(let t=0;t<n;t++)i[t+2]=null;if(Array.prototype.splice.apply(this.C,i),this.u.length>0){let i=this.u[0];i.$context.childContexts.splice(t,e);for(let e=t;e<t+n;e++){const t=r[e];i.$context.childContexts.splice(e,0,new BindingContext(t,e,i.$context))}for(let e=t+n;e<i.$context.childContexts.length;e++)i.$context.childContexts[e].$index=e}this.u.forEach(r=>{for(let n=0;n<e;n++)r.bindArray[t+n].forEach(t=>t.remove());var i=[];i[0]=t,i[1]=e;for(let t=0;t<n;t++)i[t+2]=[];Array.prototype.splice.apply(r.bindArray,i)}),this.u.forEach(e=>{var i=document.createDocumentFragment(),s=e.insertFunc,o=e.$context;for(let a=t;a<t+n;a++){const t=r[a];s.call(t,o.childContexts[a],i,e)}var a=e.bindArray;if(null==t||t>=a.length)e.appendChild(i);else if(0==t)e.prepend(i);else{var h=(a=e.bindArray[t-1])[a.length-1].nextSibling;e.insertBefore(i,h)}}),this.P.proxyHandler.I(this.R,this.P)}get(t,e,n){var r=super.get(t,e,n);return"function"==typeof r?"splice"===e?function(e){var r=arguments[0];r>t.length&&(r=t.length),r<-t.length&&(r=0),r<0&&(r=t.length+r+1);var i=1==arguments.length?t.length-r:arguments[1];i>t.length-r&&(i=t.length-r);var s=Array.prototype.splice.apply(t,arguments);return this.L(r,i,arguments.length-2,n),s}.bind(this):"push"===e?function(e){var r=t.length,i=Array.prototype.push.apply(t,arguments);return this.L(r,0,arguments.length,n),i}.bind(this):"pop"===e?function(){if(0!=t.length){var e=t.length,r=Array.prototype.pop.apply(t,arguments);return this.L(e-1,1,0,n),r}}.bind(this):"shift"===e?function(){if(0!=t.length){var e=Array.prototype.shift.apply(t,arguments);return this.L(0,1,0,n),e}}.bind(this):"unshift"===e?function(e){var r=Array.prototype.unshift.apply(t,arguments);return this.L(0,0,1,n),r}.bind(this):"reverse"===e||"sort"==e?function(r){var i=Array.prototype[e].apply(t,arguments);return this.L(0,t.length,t.length,n),i}.bind(this):"fill"===e?function(e){var r=arguments[1]||0,i=arguments[2]||t.length;r<0&&(r=ob.length+r),i<0&&(i=ob.length+i);var s=Array.prototype.fill.apply(t,arguments);return this.L(r,i,i-r,n),s}.bind(this):r.bind(n):r}set(t,e,n,r){var i=t.length,s=Reflect.set(t,e,n,r);return"length"===e?i>n&&this.L(n,i-n):t.length===i?this.L(parseInt(e),1,1,t):this.L(parseInt(e),0,1,t),s}}class BindingContext{constructor(t,e,n){this.$data=t,this.$parentContext=n,this.childContexts=[],this.S=new Proxy({$index:e},new ObjectHandler)}get $parent(){return this.$parentContext.$data}get $index(){return mb.s&&mb.o.push({handler:this.S.proxyHandler,prop:"$index"}),this.S.$index}set $index(t){this.S.$index=t}}class CustomElementHandler extends ObjectHandler{constructor(){super()}get(t,e,n){var r=super.get(t,e,n);return"function"==typeof r?function(e){var n=r.apply(t,arguments);return n}.bind(this):r}}class MicroBinderHTMLElement extends HTMLElement{constructor(t){super(),this.template=t,this.handlingAttributeChange=!1,this.settingAttribute=!1,this.proxy=new Proxy(this,new CustomElementHandler),this.attributeProperty={},this.attributesBound=!1}useShadow(){this.shadow=this.attachShadow({mode:"open"})}bindAttributes(){this.__proto__.constructor.observedAttributes.forEach(t=>{this.attributeProperty[t]=(()=>{for(const e in this)if(e.toLowerCase()==t)return e})();let e=this.attributeProperty[t];this.proxy[e]=this.getAttribute(t)||this[e],mb.bind(this.proxy,()=>this.proxy[e],(n,r)=>{if(n!=r){this.handlingAttributeChange||(""==r?this.removeAttribute(t):(this.settingAttribute=!0,this.setAttribute(t,r),this.settingAttribute=!1));var i=new Event("propchange");i.name=e,i.newValue=r,this.dispatchEvent(i)}})}),this.attributesBound=!0}disconnectedCallback(){}adoptedCallback(){}connectedCallback(){mb.render(this.proxy,this.shadow?this.shadow:this,this.template),this.__proto__.constructor.observedAttributes&&(this.settingAttribute=!0,this.__proto__.constructor.observedAttributes.forEach(t=>{var e=this[this.attributeProperty[t]];""==e?this.removeAttribute(t):this.setAttribute(t,e)}),this.settingAttribute=!1)}attributeChangedCallback(t,e,n){this.attributesBound&&!this.settingAttribute&&(this.handlingAttributeChange=!0,this.proxy[this.attributeProperty[t]]=n,this.handlingAttributeChange=!1)}}mb.templateClass=function(t){return class extends MicroBinderHTMLElement{constructor(){super(t),this.useShadow()}}};