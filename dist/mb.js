class MicroBinder{constructor(){this.t=1,this.i={},this.s=!1,this.h=[],this.bindObjects=[],this.subBinders={if:1,with:1,foreach:1},this.binders={text:(t,e,n)=>mb.bind(e,n,(e,n)=>t.innerText=n),html:(t,e,n)=>mb.bind(e,n,(e,n)=>t.innerHTML=n),value:(t,e,n)=>{mb.bind(e,n,(e,n)=>t.value=n||""),t.addEventListener("change",t=>mb.setValue(e,n,t.target.value))},textInput:(t,e,n)=>{mb.bind(e,n,(e,n)=>t.value=n||""),t.addEventListener("input",t=>mb.setValue(e,n,t.target.value))},checked:(t,e,n)=>{mb.bind(e,n,(e,n)=>{n?t.setAttribute("checked",""):t.removeAttribute("checked","")}),t.addEventListener("change",t=>mb.setValue(e,n,t.target.checked))},hasFocus:(t,e,n)=>{mb.bind(e,n,(e,n)=>n?t.focus():t.blur()),t.addEventListener("focus",t=>mb.setValue(e,n,!0)),t.addEventListener("blur",t=>mb.setValue(e,n,!1))},css:(t,e,n)=>{for(const r in n)mb.bind(e,n[r],(e,n)=>n?t.classList.add(r):t.classList.remove(r))},attr:(t,e,n)=>{for(const r in n)mb.bind(e,n[r],(e,n)=>t.setAttribute(r,n))},prop:(t,e,n)=>{for(const r in n)mb.bind(e,n[r],(e,n)=>t[r]=n);t.addEventListener("propchange",t=>{null!=n[t.name]&&mb.setValue(e,n[t.name],t.newValue)})},style:(t,e,n)=>{for(const r in n)mb.bind(e,n[r],(e,n)=>t.style[r]=n)},visible:(t,e,n)=>mb.bind(e,n,(e,n)=>t.style.display=n?null:"none"),click:(t,e,n)=>t.addEventListener("click",r=>n.call(e,t)),submit:(t,e,n)=>t.addEventListener("submit",r=>n.call(e,t)),if:(t,e,n,r)=>{t.insertFunc=this.bindObjects[r-1],mb.bind(e,n,(n,r)=>{if(r){var i=document.createDocumentFragment();t.insertFunc.call(e,e,()=>0,i,t,null,e.$parent),t.appendChild(i)}else t.innerHTML=""})},with:(t,e,n,r)=>{t.insertFunc=this.bindObjects[r-1],mb.bind(e,n,(e,n)=>{t.innerHTML="";var r=document.createDocumentFragment();t.insertFunc.call(n,n,()=>0,r,t,null,n.$parent),t.appendChild(r)})},foreach:(t,e,n,r)=>{t.insertFunc=this.bindObjects[r-1];var i=n.call(e);t.bindArray=[],i.proxyHandler.l.push(t);var s=document.createDocumentFragment();for(let e=0;e<i.length;e++){const n=i[e];t.insertFunc.call(n,n,e,s,t,i.proxyHandler,i)}t.appendChild(s)},selectedOptions:(t,e,n)=>{mb.bind(e,n,(e,n)=>{var r=n.map(t=>t.toString());Array.from(t.options).forEach(t=>t.selected=r.indexOf(t.value)>-1)}),t.addEventListener("change",t=>{var r=Array.from(t.target.selectedOptions).map(t=>t.value);mb.setValue(e,n,r)})},event:(t,e,n)=>{for(const r in n){const i=n[r];t.addEventListener(r,n=>i.call(e,t))}},enable:(t,e,n)=>{mb.bind(e,n,(e,n)=>n?t.removeAttribute("disabled"):t.setAttribute("disabled",""))},disable:(t,e,n)=>{mb.bind(e,n,(e,n)=>n?t.setAttribute("disabled",""):t.removeAttribute("disabled"))}}}bind(t,e,n,r){this.s=!0,this.h=[];var i=e.call(t);if(this.s=!1,this.h.length>0){var s=this.t++;this.i[s]=[],this.h.forEach(t=>t.handler.o(t.prop,e,n,s))}n(r,i)}setValue(t,e,n){this.u=!0,this.m=[];e.call(t);this.u=!1,this.m.length>0&&this.m.pop()(n)}executeBinding(t,e,n,r){var i=!1;for(var s in n)i=mb.binders[s](t,e,n[s],r)|i;return i}indexFunc(t,e){for(var n=t;null==n.bindIndex;)n=n.parentNode;return mb.s&&mb.h.push({handler:e,prop:"$index"}),n.bindIndex}v(t){var e=[];return e.maxDepth=0,e.push("var t = null, $index = null;\n"),e.push("var renderedElements = [];\n"),"[object NodeList]"===t.toString()?t.forEach(t=>this.p(t,e,1)):this.p(t,e,0),e.push("if(!$funcElement.bindArray)$funcElement.bindArray=[];\n"),e.push("$funcElement.bindArray[index] = renderedElements;\n"),new Function("$data,index,n0,$funcElement,handler,$parent",e.join(""))}p(t,e,n){var r=!1;if(1==t.nodeType){if(e.push(n>e.maxDepth?"var ":"","n",n," = document.createElement('",t.nodeName,"');\n"),1==n&&(e.push("n",n,".bindIndex = index;\n"),e.push("$index = mb.indexFunc.bind(null, n",n,",handler);\n")),n>e.maxDepth&&(e.maxDepth=n),t.hasAttributes()){var i=t.attributes;for(let h=i.length-1;h>=0;h--){const a=i[h].name,l=i[h].value;if("bind"==a){var s=new Function("return "+l)();(r=Object.keys(s).some(t=>Object.keys(this.subBinders).indexOf(t)>=0))&&this.bindObjects.push(this.v(t.childNodes)),e.push("{ let $element = n",n,";"),e.push("mb.executeBinding(n",n,", $data, ",l,", ",this.bindObjects.length,");\n"),e.push("}")}else e.push("n",n,".setAttribute('",a,"', '",l,"');\n")}}e.push("n",n-1,".appendChild(n",n,");\n\n"),n-1==0&&e.push("renderedElements.push(n",n,");\n\n")}else 3==t.nodeType&&(e.push("t = document.createTextNode(`",t.nodeValue,"`);\n"),e.push("n",n-1,".appendChild(t);\n\n"),n-1==0&&e.push("renderedElements.push(t);\n\n"));r||t.childNodes.forEach(t=>this.p(t,e,n+1))}render(t,e,n){var r="object"!=typeof t||t.isProxy?t:new Proxy(t,new ObjectHandler),i=null;if("string"==typeof n){var s=document.getElementById(n);if(null!=s)i=s.content?s.content.cloneNode(!0):document.createRange().createContextualFragment(s.innerHTML);else{var h=document.createDocumentFragment();h.innerHTML=n,i=h.content}}else i=n;return null==i&&(i=e||document.body),this.v(i,r).call(r,r,()=>0,e,e),r}}var mb=new MicroBinder;class ObjectHandler{constructor(){this.g=this,this.A={},this.j={},this.$parent=null}o(t,e,n,r){null==this.j[t]&&(this.j[t]=[]);var i=this.j[t],s={H:i,$:e,C:n,O:r};i.push(s),mb.i[r].push(s)}k(t,e,n,r){if(null!=this.j[t]){var i=[];this.j[t].forEach(t=>{mb.bind(e,t.$,t.C,n),i.push(t.O)}),i.forEach(t=>{mb.i[t].forEach(t=>t.H.splice(t.H.indexOf(t),1)),delete mb.i[t]})}}get(t,e,n){if("proxyHandler"===e)return this;if("$parent"===e)return this.$parent;if("isProxy"===e)return!0;if("proxyObject"===e)return t;var r=Reflect.get(t,e,n);if(mb.s&&mb.h.push({handler:this,prop:e}),this instanceof DateHandler||!mb.u||mb.m.push(t=>n[e]=t),null!=r&&"object"==typeof r){if(null==this.A[e]){var i="[object Date]"===Object.prototype.toString.call(r)?new DateHandler:Array.isArray(r)?new ArrayHandler(e,n):new ObjectHandler;i.$parent=n,this.A[e]=new Proxy(r,i)}return this.A[e]}return r}set(t,e,n,r){null!=n&&n.isProxy&&(n=n.proxyObject);var i=t[e],s=Reflect.set(t,e,n,r);if("object"==typeof n){var h=this.A[e];if(delete this.A[e],Array.isArray(n)){var a=r[e];h&&(h.length=0,a.proxyHandler.l=h.proxyHandler.l),a.proxyHandler.F(0,0,n.length,a)}}return this.k(e,r,i,n),s}}class DateHandler extends ObjectHandler{constructor(){super()}get(t,e,n){var r=super.get(t,e,n);return"function"==typeof r?function(i){var s=t,h=r.apply(t,arguments);return t!=s&&this.k(e,n,s,h),h}.bind(this):r}}class ArrayHandler extends ObjectHandler{constructor(t,e){super(),this.A=[],this.l=[],this._=t,this.I=e}F(t,e,n,r){var i=[];i[0]=t,i[1]=e;for(let t=0;t<n;t++)i[t+2]=null;Array.prototype.splice.apply(this.A,i),this.l.forEach(r=>{for(let n=0;n<e;n++)r.bindArray[t+n].forEach(t=>t.remove());var i=[];i[0]=t,i[1]=e;for(let t=0;t<n;t++)i[t+2]=[];Array.prototype.splice.apply(r.bindArray,i)}),this.l.forEach(e=>{var i=document.createDocumentFragment(),s=e.insertFunc;for(let h=t;h<t+n;h++){const t=r[h];s.call(t,t,h,i,e,this,r)}var h=e.bindArray;if(null==t||t>=h.length)e.appendChild(i);else if(0==t)e.prepend(i);else{var a=(h=e.bindArray[t-1])[h.length-1].nextSibling;e.insertBefore(i,a)}}),this.l.forEach(e=>{for(let r=t+n;r<e.bindArray.length;r++)e.bindArray[r].forEach(t=>t.bindIndex=r)}),this.k("$index",r),this.I.proxyHandler.k(this._,this.I)}get(t,e,n){var r=super.get(t,e,n);return"function"==typeof r?"splice"===e?function(e){var r=arguments[0];r>this.length&&(r=this.length),r<-this.length&&(r=0),r<0&&(r=this.length+r+1);var i=1==arguments.length?this.length-r:arguments[1];i>this.length-r&&(i=this.length-r);var s=Array.prototype.splice.apply(t,arguments);return this.F(r,i,arguments.length-2,n),s}.bind(this):"push"===e?function(e){var r=t.length,i=Array.prototype.push.apply(t,arguments);return this.F(r,0,arguments.length,n),i}.bind(this):"pop"===e?function(){if(0!=t.length){var e=t.length,r=Array.prototype.pop.apply(t,arguments);return this.F(e-1,1,0,n),r}}.bind(this):"shift"===e?function(){if(0!=t.length){var e=Array.prototype.shift.apply(t,arguments);return this.F(0,1,0,n),e}}.bind(this):"unshift"===e?function(e){var r=Array.prototype.unshift.apply(t,arguments);return this.F(0,0,1,n),r}.bind(this):"reverse"===e||"sort"==e?function(r){var i=Array.prototype[e].apply(t,arguments);return this.F(0,t.length,t.length,n),i}.bind(this):"fill"===e?function(e){var r=arguments[1]||0,i=arguments[2]||t.length;r<0&&(r=ob.length+r),i<0&&(i=ob.length+i);var s=Array.prototype.fill.apply(t,arguments);return this.F(r,i,i-r,n),s}.bind(this):r.bind(n):r}set(t,e,n,r){var i=t.length,s=Reflect.set(t,e,n,r);return"length"===e?i>n&&this.F(n,i-n):t.length===i?this.F(parseInt(e),1,1,t):this.F(parseInt(e),0,1,t),s}}class MicroBinderHTMLElement extends HTMLElement{constructor(t){super(),this.template=t,this.handlingAttributeChange=!1,this.settingAttribute=!1,this.proxy=new Proxy(this,new ObjectHandler),this.attributeProperty={}}bindAttributes(){this.__proto__.constructor.observedAttributes.forEach(t=>{this.attributeProperty[t]=(()=>{for(const e in this)if(e.toLowerCase()==t)return e})();let e=this.attributeProperty[t];this.proxy[e]=this.getAttribute(t)||this[e],mb.bind(this.proxy,()=>this.proxy[e],(n,r)=>{if(n!=r){this.handlingAttributeChange||(""==r?this.removeAttribute(t):(this.settingAttribute=!0,this.setAttribute(t,r),this.settingAttribute=!1));var i=new Event("propchange");i.name=e,i.newValue=r,this.dispatchEvent(i)}})})}disconnectedCallback(){console.log("Custom square element removed from page.")}adoptedCallback(){console.log("Custom square element moved to new page.")}connectedCallback(){console.log("Custom square element added to page."),mb.render(this,this,this.template)}attributeChangedCallback(t,e,n){console.log("Custom square element attributes changed."),this.settingAttribute||(this.handlingAttributeChange=!0,this.proxy[this.attributeProperty[t]]=n,this.handlingAttributeChange=!1)}}